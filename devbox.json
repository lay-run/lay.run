{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/main/.schema/devbox.schema.json",
  "packages": [
    "rustup@latest",
    "openssl@latest",
    "pkg-config@latest",
    "jq@latest",
    "yq@latest",
    "go-task@latest",
    "curl@latest",
    "httpie@latest",
    "podman@latest",
    "cargo-watch@latest",
    "sqlx-cli@latest",
    "process-compose@latest",
    "tmux@latest",
    "awscli2@latest",
    "pre-commit@latest"
  ],
  "shell": {
    "init_hook": [
      "export PATH=\"$PWD/cli/target/release:$PATH\"",
      "for dir in /nix/store/*openssl*-dev/lib/pkgconfig; do [ -d \"$dir\" ] && export PKG_CONFIG_PATH=\"$dir:$PKG_CONFIG_PATH\" && break; done",
      "echo '░██                       '",
      "echo '░██                       '",
      "echo '░██  ░██████   ░██    ░██ '",
      "echo '░██       ░██  ░██    ░██ '",
      "echo '░██  ░███████  ░██    ░██ '",
      "echo '░██ ░██   ░██  ░██   ░███ '",
      "echo '░██  ░█████░██  ░█████░██ '",
      "echo '                      ░██ '",
      "echo '                ░███████  '",
      "echo '                          '",
      "echo ''",
      "echo 'Setting up Rust toolchain...'",
      "if ! rustup toolchain list | grep -q 'nightly'; then",
      "  rustup toolchain install nightly",
      "fi",
      "rustup default nightly > /dev/null 2>&1",
      "echo 'Rust nightly toolchain ready'",
      "echo ''",
      "echo 'Setting up backend environment...'",
      "if [ ! -f .env ]; then",
      "  cp backend/.env.example .env",
      "  sed -i 's/postgres:postgres@localhost:5432/postgres:devpassword123@localhost:55432/' .env",
      "fi",
      "echo ''",
      "echo 'Setting up pre-commit hooks...'",
      "if [ -f .pre-commit-config.yaml ] && [ -d .git ]; then",
      "  pre-commit install --install-hooks > /dev/null 2>&1 || true",
      "  echo 'Pre-commit hooks installed'",
      "fi",
      "echo ''",
      "echo 'Commands:'",
      "echo '  lay --help      - Use the Lay CLI'",
      "echo '  devbox run up   - Start services in background (headless)'",
      "echo '  devbox run logs - Attach to view logs (Ctrl+B then D to detach)'",
      "echo '  devbox run down - Stop all services'",
      "echo '  devbox run kill - Kill all containers'",
      "echo ''"
    ],
    "scripts": {
      "up": "tmux new-session -d -s lay-dev 'process-compose up -t=false' && echo 'Services started in background. Use \"devbox run logs\" to view logs.'",
      "logs": "if tmux has-session -t lay-dev 2>/dev/null; then echo 'Attaching to logs. Press Ctrl+B then D to detach.' && sleep 1 && tmux attach -t lay-dev; else echo 'No services running. Start with: devbox run up'; fi",
      "down": "process-compose down && tmux kill-session -t lay-dev 2>/dev/null || true",
      "kill": "podman rm -f lay-postgres-dev lay-adminer-dev 2>/dev/null || true && echo 'All containers killed'"
    }
  }
}
