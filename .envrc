eval "$(devbox generate direnv --print-envrc)"

# Load root .env file
dotenv .env

# OpenSSL configuration for Rust builds
for dir in /nix/store/*openssl*-dev/lib/pkgconfig; do
  if [ -d "$dir" ]; then
    export PKG_CONFIG_PATH="$dir:$PKG_CONFIG_PATH"
    OPENSSL_DEV_PATH="${dir%/lib/pkgconfig}"
    export OPENSSL_INCLUDE_DIR="$OPENSSL_DEV_PATH/include"

    # Find corresponding lib package
    for libpath in /nix/store/*openssl-3.*/lib; do
      if [ -d "$libpath" ] && [[ ! "$libpath" =~ -dev ]]; then
        export OPENSSL_DIR="${libpath%/lib}"
        export OPENSSL_LIB_DIR="$libpath"
        break
      fi
    done
    break
  fi
done
